{% comment %}
  Enhanced product section with comprehensive features:
  - Image gallery with zoom and lightbox
  - Variant selector with price updates
  - Add to cart with quantity selector
  - Product information display
  - Social sharing
  - Pickup availability
  - Related products
{% endcomment %}

{% liquid
  assign current_variant = product.selected_or_first_available_variant
  assign product_form_id = 'product-form-' | append: section.id
  assign media_count = product.media.size
  if media_count > 0
    assign has_media = true
  else
    assign has_media = false
  endif
%}

<div class="product product--{{ section.settings.media_size }} product--{{ section.settings.gallery_layout }} product--media-{{ section.settings.media_position }} page-width">
  <div class="product__media-wrapper" data-media-gallery>
    {% if has_media %}
      <div class="product__media">
        {% for media in product.media %}
          <div class="product__media-item{% if forloop.first %} active{% endif %}" data-media-id="{{ media.id }}">
            {% case media.media_type %}
              {% when 'image' %}
                <div class="product__media-image">
                  {% if section.settings.image_zoom == 'lightbox' %}
                    <a href="{{ media | image_url: width: 2000 }}" class="product__media-zoom" data-lightbox="product-gallery">
                  {% endif %}
                    {% render 'image', 
                      image: media, 
                      class: 'product__image',
                      loading: 'eager',
                      sizes: '(min-width: 1200px) 50vw, 100vw'
                    %}
                  {% if section.settings.image_zoom == 'lightbox' %}
                    </a>
                  {% endif %}
                </div>
              {% when 'video' %}
                <div class="product__media-video">
                  {{ media | video_tag: 
                    image_size: '800x800',
                    autoplay: section.settings.enable_video_looping,
                    loop: section.settings.enable_video_looping,
                    controls: true,
                    muted: true
                  }}
                </div>
              {% when 'external_video' %}
                <div class="product__media-external-video">
                  {{ media | external_video_tag }}
                </div>
              {% when 'model' %}
                <div class="product__media-model">
                  {{ media | model_viewer_tag }}
                </div>
            {% endcase %}
          </div>
        {% endfor %}
      </div>

      {% if media_count > 1 %}
        <div class="product__media-thumbnails">
          {% for media in product.media %}
            <button class="product__media-thumbnail{% if forloop.first %} active{% endif %}" data-media-id="{{ media.id }}">
              {% render 'image', 
                image: media.preview_image, 
                class: 'product__thumbnail-image',
                sizes: '80px'
              %}
            </button>
          {% endfor %}
        </div>
      {% endif %}
    {% else %}
      <div class="product__media-placeholder">
        {{ 'product-1' | placeholder_svg_tag: 'product__placeholder' }}
      </div>
    {% endif %}
  </div>

  <div class="product__info">
    <div class="product__info-wrapper">
      {% if section.settings.show_vendor and product.vendor %}
        <div class="product__vendor">
          <span class="visually-hidden">{{ 'products.product.vendor' | t }}</span>
          {{ product.vendor | link_to: product.vendor | url_for_type: 'vendor' }}
        </div>
      {% endif %}

      <h1 class="product__title">{{ product.title | escape }}</h1>

      {% if section.settings.show_sku and current_variant.sku %}
        <div class="product__sku">
          <span class="visually-hidden">{{ 'products.product.sku' | t }}</span>
          {{ current_variant.sku }}
        </div>
      {% endif %}

      <div class="product__price" id="price-{{ section.id }}">
        {% if current_variant.compare_at_price > current_variant.price %}
          <span class="price price--sale">
            <span class="visually-hidden">{{ 'products.product.regular_price' | t }}</span>
            <s class="price__regular">{{ current_variant.compare_at_price | money }}</s>
            <span class="visually-hidden">{{ 'products.product.sale_price' | t }}</span>
            <span class="price__sale">{{ current_variant.price | money }}</span>
          </span>
        {% else %}
          <span class="price price--regular">
            <span class="visually-hidden">{{ 'products.product.regular_price' | t }}</span>
            {{ current_variant.price | money }}
          </span>
        {% endif %}
      </div>

      {% if product.description != blank %}
        <div class="product__description rte">
          {{ product.description }}
        </div>
      {% endif %}

      <product-form>
        {% form 'product', product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' %}
          <input type="hidden" name="id" value="{{ current_variant.id }}" disabled>

          {% unless product.has_only_default_variant %}
          <variant-selector data-section="{{ section.id }}" data-url="{{ product.url }}" data-update-url="true">
            <div class="product__variants">
              {% for option in product.options_with_values %}
                <fieldset class="product__option">
                  <legend class="product__option-name">{{ option.name }}</legend>
                  <div class="product__option-values">
                    {% for value in option.values %}
                      <input 
                        type="radio" 
                        id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
                        name="{{ option.name }}"
                        value="{{ value | escape }}"
                        form="{{ product_form_id }}"
                        {% if option.selected_value == value %}checked{% endif %}
                      >
                      <label for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}">
                        {{ value }}
                      </label>
                    {% endfor %}
                  </div>
                </fieldset>
              {% endfor %}
            </div>
          </variant-selector>
        {% endunless %}

        <script type="application/json" data-product-json>
          {{ product | json }}
        </script>
        
        <script type="application/json" data-variants-json>
          {{ product.variants | json }}
        </script>

        <div class="product__quantity">
          <label for="Quantity-{{ section.id }}" class="visually-hidden">{{ 'products.product.quantity.label' | t }}</label>
          <quantity-input>
            <div class="quantity-input">
              <button type="button" name="minus" class="quantity-input__button quantity-input__button--minus" aria-label="{{ 'products.product.quantity.decrease' | t: product: product.title | escape }}">
                {% render 'icons', icon: 'minus' %}
              </button>
              <input 
                type="number" 
                id="Quantity-{{ section.id }}"
                name="quantity" 
                min="1" 
                value="1" 
                class="quantity-input__input"
                form="{{ product_form_id }}"
              >
              <button type="button" name="plus" class="quantity-input__button quantity-input__button--plus" aria-label="{{ 'products.product.quantity.increase' | t: product: product.title | escape }}">
                {% render 'icons', icon: 'plus' %}
              </button>
            </div>
          </quantity-input>
        </div>

        <div class="product__buttons">
          <button
            type="submit"
            name="add"
            class="product__add-to-cart button button--primary button--full-width"
            {% if current_variant.available == false %}disabled{% endif %}
          >
            <span>
              {% if current_variant.available %}
                {{ 'products.product.add_to_cart' | t }}
              {% else %}
                {{ 'products.product.sold_out' | t }}
              {% endif %}
            </span>
            <div class="loading-overlay__spinner hidden">
              {% render 'icons', icon: 'spinner' %}
            </div>
          </button>

          {% comment %} Buy Now Button - Shopify Payment Button {% endcomment %}
          {%- if settings.enable_buy_now and current_variant.available -%}
            <div class="product__buy-now-wrapper">
              {{ form | payment_button }}
            </div>
          {%- endif -%}

          {% comment %} Accelerated Checkout Buttons {% endcomment %}
          {%- if settings.enable_accelerated_checkout and section.settings.show_payment_button -%}
            <div class="product__payment-buttons">
              {{ form | payment_button }}
            </div>
          {%- endif -%}
        </div>

        {% if section.settings.enable_pickup_availability %}
          <div class="product__pickup-availability">
            {% render 'pickup-availability', variant: current_variant %}
          </div>
        {% endif %}
        {% endform %}
      </product-form>

      {% if section.settings.show_share_buttons %}
        <div class="product__share">
          <span class="product__share-label">{{ 'products.product.share' | t }}</span>
          {% render 'social-sharing', share_title: product.title, share_permalink: product.url, share_image: product.featured_media %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

{% comment %}
  Product section styles are now loaded from assets/product.css
  Product section scripts are now loaded from assets/product.js
{% endcomment %}

{% schema %}
{
  "name": "t:general.product",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sticky_info",
      "default": true,
      "label": "t:sections.main-product.settings.enable_sticky_info.label"
    },
    {
      "type": "checkbox",
      "id": "enable_zoom",
      "default": true,
      "label": "t:sections.main-product.settings.enable_zoom.label"
    },
    {
      "type": "select",
      "id": "media_size",
      "options": [
        {
          "value": "small",
          "label": "t:sections.main-product.settings.media_size.options__1.label"
        },
        {
          "value": "medium",
          "label": "t:sections.main-product.settings.media_size.options__2.label"
        },
        {
          "value": "large",
          "label": "t:sections.main-product.settings.media_size.options__3.label"
        }
      ],
      "default": "large",
      "label": "t:sections.main-product.settings.media_size.label"
    },
    {
      "type": "select",
      "id": "media_fit",
      "options": [
        {
          "value": "contain",
          "label": "t:sections.main-product.settings.media_fit.options__1.label"
        },
        {
          "value": "cover",
          "label": "t:sections.main-product.settings.media_fit.options__2.label"
        }
      ],
      "default": "contain",
      "label": "t:sections.main-product.settings.media_fit.label"
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "options": [
        {
          "value": "stacked",
          "label": "t:sections.main-product.settings.gallery_layout.options__1.label"
        },
        {
          "value": "thumbnail",
          "label": "t:sections.main-product.settings.gallery_layout.options__2.label"
        },
        {
          "value": "thumbnail_slider",
          "label": "t:sections.main-product.settings.gallery_layout.options__3.label"
        }
      ],
      "default": "stacked",
      "label": "t:sections.main-product.settings.gallery_layout.label"
    },
    {
      "type": "select",
      "id": "media_position",
      "options": [
        {
          "value": "left",
          "label": "t:sections.main-product.settings.media_position.options__1.label"
        },
        {
          "value": "right",
          "label": "t:sections.main-product.settings.media_position.options__2.label"
        }
      ],
      "default": "left",
      "label": "t:sections.main-product.settings.media_position.label"
    },
    {
      "type": "select",
      "id": "image_zoom",
      "options": [
        {
          "value": "lightbox",
          "label": "t:sections.main-product.settings.image_zoom.options__1.label"
        },
        {
          "value": "hover",
          "label": "t:sections.main-product.settings.image_zoom.options__2.label"
        },
        {
          "value": "none",
          "label": "t:sections.main-product.settings.image_zoom.options__3.label"
        }
      ],
      "default": "lightbox",
      "label": "t:sections.main-product.settings.image_zoom.label"
    },
    {
      "type": "select",
      "id": "mobile_thumbnails",
      "options": [
        {
          "value": "show",
          "label": "t:sections.main-product.settings.mobile_thumbnails.options__1.label"
        },
        {
          "value": "hide",
          "label": "t:sections.main-product.settings.mobile_thumbnails.options__2.label"
        }
      ],
      "default": "hide",
      "label": "t:sections.main-product.settings.mobile_thumbnails.label"
    },
    {
      "type": "checkbox",
      "id": "hide_variants",
      "default": false,
      "label": "t:sections.main-product.settings.hide_variants.label"
    },
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "default": false,
      "label": "t:sections.main-product.settings.enable_video_looping.label"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header__1.content"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "t:sections.main-product.settings.show_vendor.label"
    },
    {
      "type": "checkbox",
      "id": "show_sku",
      "default": false,
      "label": "t:sections.main-product.settings.show_sku.label"
    },
    {
      "type": "checkbox",
      "id": "show_type",
      "default": false,
      "label": "t:sections.main-product.settings.show_type.label"
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "default": false,
      "label": "t:sections.main-product.settings.show_tags.label"
    },
    {
      "type": "checkbox",
      "id": "show_share_buttons",
      "default": true,
      "label": "t:sections.main-product.settings.show_share_buttons.label"
    },
    {
      "type": "checkbox",
      "id": "enable_pickup_availability",
      "default": true,
      "label": "t:sections.main-product.settings.enable_pickup_availability.label"
    },
    {
      "type": "checkbox",
      "id": "show_payment_button",
      "default": true,
      "label": "t:sections.main-product.settings.show_payment_button.label"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  }
}
{% endschema %}
