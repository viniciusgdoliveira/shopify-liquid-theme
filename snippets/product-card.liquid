{% comment %}
  Product Card Component
  Reusable product card with customizable features and Allbirds-inspired design
  
  Parameters:
  - product: Product object (required)
  - show_vendor: Boolean (default: true)
  - show_rating: Boolean (default: false)
  - show_quick_add: Boolean (default: true)
  - image_ratio: String (default: 'square')
  - card_style: String (default: 'default')
  - show_badges: Boolean (default: true)
  - show_sustainability: Boolean (default: false)
{% endcomment %}

{% liquid
  assign show_vendor = show_vendor | default: true
  assign show_rating = show_rating | default: false
  assign show_quick_add = show_quick_add | default: true
  assign image_ratio = image_ratio | default: 'square'
  assign card_style = card_style | default: 'default'
  assign show_badges = show_badges | default: true
  assign show_sustainability = show_sustainability | default: false
%}

<div class="product-card product-card--{{ card_style }}" data-product-id="{{ product.id }}">
  <div class="product-card__image-wrapper product-card__image-wrapper--{{ image_ratio }}">
    {% if product.featured_image %}
      <a href="{{ product.url }}" class="product-card__image-link">
        {% render 'image',
          image: product.featured_image,
          class: 'product-card__image',
          width: 400,
          height: 400,
          crop: 'center',
          loading: 'lazy'
        %}
      </a>
    {% else %}
      <div class="product-card__image-placeholder">
        {{ 'product-1' | placeholder_svg_tag: 'product-card__placeholder' }}
      </div>
    {% endif %}
    
    {% comment %} Product Badges {% endcomment %}
    {% if show_badges %}
      {% if product.compare_at_price > product.price %}
        <div class="product-card__badge product-card__badge--sale">
          {{ 'products.product.sale' | t }}
        </div>
      {% endif %}
      
      {% comment %} NEW badge for products created within last 30 days {% endcomment %}
      {% assign product_age = product.created_at | date: '%s' %}
      {% assign current_time = 'now' | date: '%s' %}
      {% assign age_in_days = current_time | minus: product_age | divided_by: 86400 %}
      {% if age_in_days <= 30 %}
        <div class="product-card__badge product-card__badge--new">
          {{ 'products.product.new' | t }}
        </div>
      {% endif %}
      
      {% comment %} BESTSELLER badge {% endcomment %}
      {% if product.tags contains 'bestseller' %}
        <div class="product-card__badge product-card__badge--bestseller">
          {{ 'products.product.bestseller' | t }}
        </div>
      {% endif %}
      
      {% comment %} SOLD OUT badge {% endcomment %}
      {% unless product.available %}
        <div class="product-card__badge product-card__badge--sold-out">
          {{ 'products.product.sold_out' | t }}
        </div>
      {% endunless %}
    {% endif %}
    
    {% comment %} Quick Add Button {% endcomment %}
    {% if show_quick_add and product.available %}
      <div class="product-card__quick-add">
        <button 
          type="button" 
          class="product-card__quick-add-btn" 
          data-product-id="{{ product.id }}"
          data-variant-id="{{ product.selected_or_first_available_variant.id }}"
          aria-label="{{ 'products.product.quick_add' | t: title: product.title }}"
        >
          <span class="product-card__quick-add-text">{{ 'products.product.quick_add' | t }}</span>
          <span class="product-card__quick-add-icon">
            {% render 'icons', icon: 'cart' %}
          </span>
        </button>
      </div>
    {% endif %}
    
    {% comment %} Sustainability Badge {% endcomment %}
    {% if show_sustainability and product.tags contains 'sustainable' %}
      <div class="product-card__sustainability">
        {% render 'icons', icon: 'leaf' %}
        <span>{{ 'products.product.sustainable' | t }}</span>
      </div>
    {% endif %}
  </div>
  
  <div class="product-card__content">
    {% if show_vendor and product.vendor %}
      <div class="product-card__vendor">
        {{ product.vendor }}
      </div>
    {% endif %}
    
    <h3 class="product-card__title">
      <a href="{{ product.url }}" class="product-card__title-link">
        {{ product.title }}
      </a>
    </h3>
    
    {% comment %} Product Rating {% endcomment %}
    {% if show_rating and product.metafields.reviews.rating.value %}
      <div class="product-card__rating" data-rating="{{ product.metafields.reviews.rating.value }}">
        <div class="product-card__stars">
          {% for i in (1..5) %}
            <span class="product-card__star {% if i <= product.metafields.reviews.rating.value %}product-card__star--filled{% endif %}">
              {% render 'icons', icon: 'star' %}
            </span>
          {% endfor %}
        </div>
        <span class="product-card__rating-count">
          ({{ product.metafields.reviews.rating_count.value | default: 0 }})
        </span>
      </div>
    {% endif %}
    
    {% comment %} Product Price {% endcomment %}
    <div class="product-card__price">
      {% if product.compare_at_price > product.price %}
        <span class="product-card__price-compare">{{ product.compare_at_price | money }}</span>
        <span class="product-card__price-current product-card__price-current--sale">{{ product.price | money }}</span>
      {% else %}
        <span class="product-card__price-current">{{ product.price | money }}</span>
      {% endif %}
    </div>
    
    {% comment %} Product Options Preview (for variant-heavy products) {% endcomment %}
    {% if product.variants.size > 1 and product.options.size > 0 %}
      <div class="product-card__options">
        {% for option in product.options limit: 2 %}
          {% if option.name != 'Title' %}
            <div class="product-card__option">
              <span class="product-card__option-name">{{ option.name }}:</span>
              <span class="product-card__option-values">
                {% for value in option.values limit: 3 %}
                  {{ value }}{% unless forloop.last %}, {% endunless %}
                {% endfor %}
                {% if option.values.size > 3 %}...{% endif %}
              </span>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

{% stylesheet %}
/* Product Card Component - Allbirds-inspired design */
.product-card {
  position: relative;
  background: var(--color-background, #ffffff);
  border-radius: 0.5rem;
  overflow: hidden;
  transition: all 0.3s ease;
  border: 1px solid var(--color-border-light, #f0f0f0);
}

.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  border-color: var(--color-border, #e0e0e0);
}

/* Image Wrapper */
.product-card__image-wrapper {
  position: relative;
  overflow: hidden;
  background: var(--color-background-secondary, #f5f5f0);
}

.product-card__image-wrapper--square {
  aspect-ratio: 1;
}

.product-card__image-wrapper--portrait {
  aspect-ratio: 3/4;
}

.product-card__image-wrapper--landscape {
  aspect-ratio: 4/3;
}

.product-card__image-link {
  display: block;
  width: 100%;
  height: 100%;
}

.product-card__image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.product-card:hover .product-card__image {
  transform: scale(1.05);
}

.product-card__image-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-background-secondary, #f5f5f0);
}

.product-card__placeholder {
  width: 100%;
  height: 100%;
  opacity: 0.3;
}

/* Product Badges */
.product-card__badge {
  position: absolute;
  top: 0.75rem;
  left: 0.75rem;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.025em;
  z-index: 2;
}

.product-card__badge--sale {
  background: var(--color-accent-red, #dc3545);
  color: var(--color-text-inverse, #ffffff);
}

.product-card__badge--new {
  background: var(--color-accent-green, #28a745);
  color: var(--color-text-inverse, #ffffff);
}

.product-card__badge--bestseller {
  background: var(--color-thunder-green, #2d5016);
  color: var(--color-text-inverse, #ffffff);
}

.product-card__badge--sold-out {
  background: var(--color-warm-gray, #6c6c6c);
  color: var(--color-text-inverse, #ffffff);
}

/* Quick Add Button */
.product-card__quick-add {
  position: absolute;
  bottom: 0.75rem;
  right: 0.75rem;
  opacity: 0;
  transform: translateY(10px);
  transition: all 0.3s ease;
  z-index: 3;
}

.product-card:hover .product-card__quick-add {
  opacity: 1;
  transform: translateY(0);
}

.product-card__quick-add-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  background: var(--color-natural-white, #ffffff);
  border: 1px solid var(--color-border, #e0e0e0);
  border-radius: 0.375rem;
  color: var(--color-text-primary, #000000);
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.product-card__quick-add-btn:hover {
  background: var(--color-thunder-green, #2d5016);
  color: var(--color-text-inverse, #ffffff);
  border-color: var(--color-thunder-green, #2d5016);
  transform: scale(1.05);
}

.product-card__quick-add-btn:active {
  transform: scale(0.95);
}

.product-card__quick-add-icon {
  width: 1rem;
  height: 1rem;
}

/* Sustainability Badge */
.product-card__sustainability {
  position: absolute;
  top: 0.75rem;
  right: 0.75rem;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.25rem 0.5rem;
  background: var(--color-sustainability-bg, rgba(40, 167, 69, 0.1));
  border: 1px solid var(--color-sustainability-border, rgba(40, 167, 69, 0.2));
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--color-sustainability-text, #28a745);
  z-index: 2;
}

.product-card__sustainability svg {
  width: 0.75rem;
  height: 0.75rem;
}

/* Content */
.product-card__content {
  padding: 1rem;
}

.product-card__vendor {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--color-text-secondary, #6c6c6c);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0.25rem;
}

.product-card__title {
  margin: 0 0 0.5rem 0;
  font-size: 1rem;
  font-weight: 600;
  line-height: 1.4;
}

.product-card__title-link {
  color: var(--color-text-primary, #000000);
  text-decoration: none;
  transition: color 0.2s ease;
}

.product-card__title-link:hover {
  color: var(--color-thunder-green, #2d5016);
  text-decoration: none;
}

/* Rating */
.product-card__rating {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.product-card__stars {
  display: flex;
  gap: 0.125rem;
}

.product-card__star {
  width: 0.875rem;
  height: 0.875rem;
  color: var(--color-border, #e0e0e0);
  transition: color 0.2s ease;
}

.product-card__star--filled {
  color: var(--color-accent-orange, #fd7e14);
}

.product-card__rating-count {
  font-size: 0.75rem;
  color: var(--color-text-secondary, #6c6c6c);
}

/* Price */
.product-card__price {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.product-card__price-current {
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-text-primary, #000000);
}

.product-card__price-current--sale {
  color: var(--color-accent-red, #dc3545);
}

.product-card__price-compare {
  font-size: 0.875rem;
  color: var(--color-text-secondary, #6c6c6c);
  text-decoration: line-through;
}

/* Options */
.product-card__options {
  margin-top: 0.5rem;
}

.product-card__option {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  margin-bottom: 0.25rem;
}

.product-card__option-name {
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--color-text-secondary, #6c6c6c);
}

.product-card__option-values {
  font-size: 0.75rem;
  color: var(--color-text-primary, #000000);
}

/* Card Style Variations */
.product-card--minimal {
  border: none;
  box-shadow: none;
}

.product-card--minimal:hover {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

.product-card--compact .product-card__content {
  padding: 0.75rem;
}

.product-card--compact .product-card__title {
  font-size: 0.875rem;
}

.product-card--compact .product-card__price-current {
  font-size: 0.875rem;
}

/* Responsive Design */
@media screen and (max-width: 768px) {
  .product-card__quick-add {
    opacity: 1;
    transform: translateY(0);
  }
  
  .product-card__content {
    padding: 0.75rem;
  }
  
  .product-card__title {
    font-size: 0.875rem;
  }
  
  .product-card__price-current {
    font-size: 0.875rem;
  }
}
{% endstylesheet %}

{% javascript %}
// Product Card Quick Add Functionality
document.addEventListener('DOMContentLoaded', function() {
  const quickAddButtons = document.querySelectorAll('.product-card__quick-add-btn');
  
  quickAddButtons.forEach(button => {
    button.addEventListener('click', async function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const productId = this.dataset.productId;
      const variantId = this.dataset.variantId;
      const originalText = this.querySelector('.product-card__quick-add-text').textContent;
      const originalIcon = this.querySelector('.product-card__quick-add-icon').innerHTML;
      
      // Update button state
      this.disabled = true;
      this.querySelector('.product-card__quick-add-text').textContent = 'Adding...';
      this.querySelector('.product-card__quick-add-icon').innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M12 6v6l4 2"></path>
        </svg>
      `;
      
      try {
        // Add to cart
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: variantId,
            quantity: 1
          })
        });
        
        if (response.ok) {
          // Success state
          this.querySelector('.product-card__quick-add-text').textContent = 'Added!';
          this.querySelector('.product-card__quick-add-icon').innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
          `;
          this.style.background = 'var(--color-accent-green, #28a745)';
          this.style.borderColor = 'var(--color-accent-green, #28a745)';
          this.style.color = 'var(--color-text-inverse, #ffffff)';
          
          // Update cart count if cart drawer is available
          if (window.cartUtils && window.cartUtils.updateCartCount) {
            window.cartUtils.updateCartCount();
          }
          
          // Reset after 2 seconds
          setTimeout(() => {
            this.disabled = false;
            this.querySelector('.product-card__quick-add-text').textContent = originalText;
            this.querySelector('.product-card__quick-add-icon').innerHTML = originalIcon;
            this.style.background = '';
            this.style.borderColor = '';
            this.style.color = '';
          }, 2000);
          
        } else {
          throw new Error('Failed to add to cart');
        }
      } catch (error) {
        console.error('Quick add failed:', error);
        
        // Error state
        this.querySelector('.product-card__quick-add-text').textContent = 'Error';
        this.style.background = 'var(--color-accent-red, #dc3545)';
        this.style.borderColor = 'var(--color-accent-red, #dc3545)';
        this.style.color = 'var(--color-text-inverse, #ffffff)';
        
        // Reset after 2 seconds
        setTimeout(() => {
          this.disabled = false;
          this.querySelector('.product-card__quick-add-text').textContent = originalText;
          this.querySelector('.product-card__quick-add-icon').innerHTML = originalIcon;
          this.style.background = '';
          this.style.borderColor = '';
          this.style.color = '';
        }, 2000);
      }
    });
  });
});
{% endjavascript %}
