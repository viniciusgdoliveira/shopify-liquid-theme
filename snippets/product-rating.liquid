{% comment %}
  Product Rating Snippet
  Displays product rating with stars and review count
{% endcomment %}

{% liquid
  assign rating = product.metafields.reviews.rating.value | default: 4.5
  assign review_count = product.metafields.reviews.rating_count | default: 24
  assign show_review_count = show_review_count | default: true
  assign show_stars = show_stars | default: true
  assign size = size | default: 'medium'
  assign color = color | default: 'warning'
%}

<div class="product-rating product-rating--{{ size }} product-rating--{{ color }}" 
     data-rating="{{ rating }}" 
     data-review-count="{{ review_count }}"
     {% if product.id %}data-product-id="{{ product.id }}"{% endif %}>

  {% if show_stars %}
    <div class="product-rating__stars" aria-label="Rating: {{ rating }} out of 5 stars">
      {% assign full_stars = rating | floor %}
      {% assign has_half_star = rating | modulo: 1 | round: 1 %}
      
      {% for i in (1..5) %}
        {% if i <= full_stars %}
          <span class="product-rating__star product-rating__star--full" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </span>
        {% elsif i == full_stars | plus: 1 and has_half_star > 0.3 %}
          <span class="product-rating__star product-rating__star--half" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <defs>
                <linearGradient id="half-star-{{ product.id | default: 'default' }}-{{ forloop.index }}">
                  <stop offset="50%" stop-color="currentColor"/>
                  <stop offset="50%" stop-color="transparent"/>
                </linearGradient>
              </defs>
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="url(#half-star-{{ product.id | default: 'default' }}-{{ forloop.index }})"/>
            </svg>
          </span>
        {% else %}
          <span class="product-rating__star product-rating__star--empty" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </span>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  {% if show_review_count and review_count > 0 %}
    <div class="product-rating__count">
      <span class="product-rating__rating-value">{{ rating }}</span>
      <span class="product-rating__review-count">({{ review_count }} review{% if review_count != 1 %}s{% endif %})</span>
    </div>
  {% endif %}
</div>

{% stylesheet %}
.product-rating {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-family: var(--font-family-primary);
}

.product-rating__stars {
  display: flex;
  align-items: center;
  gap: var(--space-1);
}

.product-rating__star {
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-warning);
  transition: color var(--duration-200) var(--ease-out);
}

.product-rating__star--full {
  color: var(--color-warning);
}

.product-rating__star--half {
  color: var(--color-warning);
}

.product-rating__star--empty {
  color: var(--color-border);
}

.product-rating__count {
  display: flex;
  align-items: center;
  gap: var(--space-1);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.product-rating__rating-value {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-primary);
}

.product-rating__review-count {
  color: var(--color-text-secondary);
}

/* Size Variations */
.product-rating--small .product-rating__star {
  width: 1rem;
  height: 1rem;
}

.product-rating--small .product-rating__star svg {
  width: 100%;
  height: 100%;
}

.product-rating--small .product-rating__count {
  font-size: var(--font-size-xs);
}

.product-rating--medium .product-rating__star {
  width: 1.25rem;
  height: 1.25rem;
}

.product-rating--medium .product-rating__star svg {
  width: 100%;
  height: 100%;
}

.product-rating--medium .product-rating__count {
  font-size: var(--font-size-sm);
}

.product-rating--large .product-rating__star {
  width: 1.5rem;
  height: 1.5rem;
}

.product-rating--large .product-rating__star svg {
  width: 100%;
  height: 100%;
}

.product-rating--large .product-rating__count {
  font-size: var(--font-size-base);
}

/* Color Variations */
.product-rating--warning .product-rating__star--full,
.product-rating--warning .product-rating__star--half {
  color: var(--color-warning);
}

.product-rating--primary .product-rating__star--full,
.product-rating--primary .product-rating__star--half {
  color: var(--color-primary);
}

.product-rating--success .product-rating__star--full,
.product-rating--success .product-rating__star--half {
  color: var(--color-success);
}

/* Interactive States */
.product-rating[data-clickable="true"] {
  cursor: pointer;
}

.product-rating[data-clickable="true"]:hover .product-rating__star--empty {
  color: var(--color-warning);
}

/* Accessibility */
.product-rating__star svg {
  display: block;
}

/* Responsive */
@media screen and (max-width: 480px) {
  .product-rating--large .product-rating__star {
    width: 1.25rem;
    height: 1.25rem;
  }
  
  .product-rating--large .product-rating__count {
    font-size: var(--font-size-sm);
  }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
  .product-rating__star--empty {
    color: var(--color-text-tertiary);
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .product-rating__star {
    transition: none;
  }
}
{% endstylesheet %}
