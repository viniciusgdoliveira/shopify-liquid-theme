{% comment %}
  SEO Optimization Snippet
  Provides comprehensive SEO meta tags, structured data, and optimization
{% endcomment %}

{% liquid
  assign page_title = page_title | default: page_title
  assign page_description = page_description | default: page_description
  assign page_image = page_image | default: page_image
  assign page_url = page_url | default: canonical_url
  assign page_type = page_type | default: 'website'
  assign site_name = site_name | default: shop.name
%}

<!-- SEO Meta Tags -->
<title>{{ page_title | escape }}</title>
<meta name="description" content="{{ page_description | escape }}">
<meta name="keywords" content="{{ page_keywords | escape }}">

<!-- Open Graph Meta Tags -->
<meta property="og:type" content="{{ page_type }}">
<meta property="og:title" content="{{ page_title | escape }}">
<meta property="og:description" content="{{ page_description | escape }}">
<meta property="og:url" content="{{ page_url }}">
<meta property="og:site_name" content="{{ site_name | escape }}">
{% if page_image %}
  <meta property="og:image" content="{{ page_image | image_url: width: 1200 }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="{{ page_title | escape }}">
{% endif %}

<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ page_title | escape }}">
<meta name="twitter:description" content="{{ page_description | escape }}">
{% if page_image %}
  <meta name="twitter:image" content="{{ page_image | image_url: width: 1200 }}">
  <meta name="twitter:image:alt" content="{{ page_title | escape }}">
{% endif %}
{% if shop.twitter_handle %}
  <meta name="twitter:site" content="@{{ shop.twitter_handle }}">
{% endif %}

<!-- Additional SEO Meta Tags -->
<meta name="robots" content="index, follow">
<meta name="googlebot" content="index, follow">
<meta name="author" content="{{ shop.name | escape }}">
<meta name="publisher" content="{{ shop.name | escape }}">
<meta name="copyright" content="{{ shop.name | escape }}">
<meta name="language" content="{{ request.locale.iso_code }}">

<!-- Canonical URL -->
<link rel="canonical" href="{{ canonical_url }}">

<!-- Alternate Language URLs -->
{% for locale in shop.published_locales %}
  {% if locale.iso_code != request.locale.iso_code %}
    <link rel="alternate" hreflang="{{ locale.iso_code }}" href="{{ canonical_url | replace: request.locale.iso_code, locale.iso_code }}">
  {% endif %}
{% endfor %}

<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ page_type | capitalize }}",
  "name": "{{ page_title | escape }}",
  "description": "{{ page_description | escape }}",
  "url": "{{ page_url }}",
  "publisher": {
    "@type": "Organization",
    "name": "{{ shop.name | escape }}",
    "url": "{{ shop.url }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ shop.logo | image_url: width: 200 }}"
    }
  },
  {% if page_image %}
  "image": {
    "@type": "ImageObject",
    "url": "{{ page_image | image_url: width: 1200 }}",
    "width": 1200,
    "height": 630
  },
  {% endif %}
  "datePublished": "{{ page.published_at | date: '%Y-%m-%d' }}",
  "dateModified": "{{ page.updated_at | date: '%Y-%m-%d' }}"
}
</script>

<!-- Organization Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "{{ shop.name | escape }}",
  "url": "{{ shop.url }}",
  "logo": "{{ shop.logo | image_url: width: 200 }}",
  "description": "{{ shop.description | escape }}",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "{{ shop.address.address1 }}",
    "addressLocality": "{{ shop.address.city }}",
    "addressRegion": "{{ shop.address.province }}",
    "postalCode": "{{ shop.address.zip }}",
    "addressCountry": "{{ shop.address.country }}"
  },
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "{{ shop.phone }}",
    "contactType": "customer service",
    "email": "{{ shop.email }}"
  },
  "sameAs": [
    {% if shop.social_twitter_link %}"{{ shop.social_twitter_link }}"{% endif %},
    {% if shop.social_facebook_link %}"{{ shop.social_facebook_link }}"{% endif %},
    {% if shop.social_instagram_link %}"{{ shop.social_instagram_link }}"{% endif %},
    {% if shop.social_youtube_link %}"{{ shop.social_youtube_link }}"{% endif %}
  ]
}
</script>

<!-- Breadcrumb Structured Data -->
{% if breadcrumbs %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {% for breadcrumb in breadcrumbs %}
    {
      "@type": "ListItem",
      "position": {{ forloop.index }},
      "name": "{{ breadcrumb.title | escape }}",
      "item": "{{ breadcrumb.url }}"
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>
{% endif %}

<!-- Product Structured Data -->
{% if product %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ product.title | escape }}",
  "description": "{{ product.description | strip_html | escape }}",
  "image": [
    {% for image in product.images %}
    "{{ image | image_url: width: 800 }}"{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ],
  "sku": "{{ product.selected_or_first_available_variant.sku }}",
  "brand": {
    "@type": "Brand",
    "name": "{{ product.vendor | escape }}"
  },
  "offers": {
    "@type": "Offer",
    "price": "{{ product.selected_or_first_available_variant.price | money_without_currency }}",
    "priceCurrency": "{{ shop.currency }}",
    "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
    "seller": {
      "@type": "Organization",
      "name": "{{ shop.name | escape }}"
    }
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{ product.metafields.reviews.rating.value }}",
    "reviewCount": "{{ product.metafields.reviews.rating_count.value }}"
  }
}
</script>
{% endif %}

<!-- Collection Structured Data -->
{% if collection %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ collection.title | escape }}",
  "description": "{{ collection.description | strip_html | escape }}",
  "url": "{{ collection.url }}",
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": "{{ collection.products_count }}",
    "itemListElement": [
      {% for product in collection.products limit: 10 %}
      {
        "@type": "Product",
        "name": "{{ product.title | escape }}",
        "url": "{{ product.url }}",
        "image": "{{ product.featured_image | image_url: width: 400 }}"
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
}
</script>
{% endif %}

<!-- Article Structured Data -->
{% if article %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ article.title | escape }}",
  "description": "{{ article.excerpt | strip_html | escape }}",
  "image": "{{ article.image | image_url: width: 1200 }}",
  "author": {
    "@type": "Person",
    "name": "{{ article.author | escape }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ shop.name | escape }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ shop.logo | image_url: width: 200 }}"
    }
  },
  "datePublished": "{{ article.published_at | date: '%Y-%m-%d' }}",
  "dateModified": "{{ article.updated_at | date: '%Y-%m-%d' }}"
}
</script>
{% endif %}

<!-- FAQ Structured Data -->
{% if page.handle == 'faq' or page.handle == 'help' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {% for block in page.blocks %}
    {% if block.type == 'faq' %}
    {
      "@type": "Question",
      "name": "{{ block.settings.question | escape }}",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "{{ block.settings.answer | strip_html | escape }}"
      }
    }{% unless forloop.last %},{% endunless %}
    {% endif %}
    {% endfor %}
  ]
}
</script>
{% endif %}

<!-- Performance Hints -->
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//cdn.shopify.com">
<link rel="preconnect" href="//fonts.gstatic.com" crossorigin>

<!-- Sitemap -->
<link rel="sitemap" type="application/xml" href="/sitemap.xml">

<!-- RSS Feed -->
{% if blog %}
<link rel="alternate" type="application/rss+xml" title="{{ blog.title | escape }} RSS Feed" href="{{ blog.url }}.atom">
{% endif %}
